<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é£Ÿäº‹ãƒãƒ©ãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«</title>
<link rel="manifest" href="manifest.json">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
/* --- CSS ã¯å…ˆã»ã©ã¨åŒã˜ --- */
</style>
</head>
<body>
<div class="container">
<!-- ----------- çœç•¥ï¼šHTML éƒ¨åˆ†ã¯ãã®ã¾ã¾ ----------- -->
</div>

<script>
/* Service Worker */
if('serviceWorker' in navigator){navigator.serviceWorker.register('./service-worker.js');}

/* å®šæ•°ã¨å¤‰æ•° */
const STORAGE_KEY='mealData_v1';
const mealNames=[['breakfast','ğŸŒ… æœé£Ÿ'],['lunch','ğŸŒ æ˜¼é£Ÿ'],['dinner','ğŸŒ™ å¤•é£Ÿ']];
const foodGroups=[['staple','ä¸»é£Ÿ'],['side','å‰¯èœ'],['main','ä¸»èœ'],['dairy','ä¹³ãƒ»ä¹³è£½å“'],['fruit','æœç‰©']];
const recommended={staple:5,side:5,main:3,dairy:2,fruit:2};
let mealData={},chart;

/* æ—§ã‚­ãƒ¼å‰Šé™¤ */
if(localStorage.getItem('mealData') && !localStorage.getItem(STORAGE_KEY)){
  localStorage.removeItem('mealData');
}

/* --- UI ç”Ÿæˆãƒ»æ“ä½œç³»ï¼ˆcreateMealCards, changeCount, getTotals â€¦ï¼‰--- */
/* --- saveDailyRecord, clearAllData, drawChart, updateSummary ãªã© --- */

/* ===== CSV æ›¸ãå‡ºã—ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼1è¡Œï¼‹CRLFï¼‹UTFâ€‘8 BOMï¼‰ ===== */
function downloadCSV(){
  if(Object.keys(mealData).length===0){
    alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“'); return;
  }
  const header=['date','staple','side','main','dairy','fruit','score'];
  let csv='\uFEFF'+header.join(',')+'\r\n';            // BOM + CRLF
  Object.keys(mealData).sort().forEach(dt=>{
    const m=mealData[dt];
    csv+=[dt,m.staple,m.side,m.main,m.dairy,m.fruit,m.score].join(',')+'\r\n';
  });
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='meal_balance_records.csv';
  a.click();URL.revokeObjectURL(url);
}
/* =================================================== */

/* åˆæœŸåŒ– */
function init(){
  document.getElementById('meal-date').valueAsDate=new Date();
  createMealCards();loadStorage();redraw({staple:0,side:0,main:0,dairy:0,fruit:0});updateTodayScore();
}
init();
</script>
</body>
</html>
